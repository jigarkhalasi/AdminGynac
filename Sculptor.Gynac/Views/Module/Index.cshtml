@{
    ViewBag.Title = "Index";
    Layout = "~/Views/Shared/_Layout.cshtml";

    SelectList ModuleList = ViewBag.moduleList;
}

@Styles.Render("~/Content/css")
<style>
    * {
        -moz-box-sizing: border-box;
        -webkit-box-sizing: border-box;
        box-sizing: border-box;
        margin: 0;
        padding: 0;
    }

    .item {
        position: relative;
        border: 1px solid #333;
        margin: 2%;
        overflow: hidden;
        width: 300px;
    }

        .item img {
            max-width: 100%;
            -moz-transition: all 0.3s;
            -webkit-transition: all 0.3s;
            transition: all 0.3s;
        }

        .item:hover img {
            -moz-transform: scale(1.1);
            -webkit-transform: scale(1.1);
            transform: scale(1.1);
        }
</style>


<!--banner-->
<div class="banner">
    <h2>
        <a href="/Home/Index">Home</a>
        <i class="fa fa-angle-right"></i>
        <span>Upload</span>
    </h2>
</div>
<!--//banner-->
<!--faq-->
<div class="blank">
    <div class="blank-page">
        <div class="row" style="margin-top:5px;">
            <div class="col-md-12">
                <div class="row">
                    <div class="col-md-2">
                        @Html.DropDownList("ModuleMaster", ModuleList, "Seelct Module")
                    </div>
                    <div class="col-md-10"></div>
                </div>
                <div class="row" style="margin-top:25px;">
                    <div class="col-md-2">
                        <textarea rows="4" cols="60" id="moduleImageDesc" placeholder="Enter Description"></textarea>
                    </div>
                    <div class="col-md-8">                      
                    </div>
                </div>
                <div class="row" style="margin-top:25px;">
                    <div class="col-md-4">
                        <input type="file" id="FileUpload1" multiple />
                    </div>
                    <div class="col-md-8">
                        <input type="button" id="btnUpload" value="Submit" />                     
                    </div>
                </div>
                <div class="row" style="margin-top:25px;">
                    <div class="col-md-12">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>Id</th>
                                    <th>SampleImage</th>
                                    <th>Description</th>                                    
                                    @*<th>Action</th>*@
                                </tr>
                            </thead>
                            <tbody id="moduleImage"></tbody>
                        </table>
                        <div id="display" style="display:none;text-align:center">Please select Module</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>


@Scripts.Render("~/bundles/jquery")
@Scripts.Render("~/bundles/bootstrap")

<script type="text/javascript">


    $(document).ready(function () {
        $("#display").show();
        $("#ModuleMaster").change(function () {
            var id = $("#ModuleMaster").val();
            if (id != "") {
                getImageByModule(id);
            }
            else {
                alert("Please select the module first! ");
            }
        });

        function getImageByModule(moduleId) {
            $.ajax({
                type: "GET",
                url: '/Module/GetSampleImages?moduleId=' + moduleId,
                contentType: "application/json; charset=utf-8",
                dataType: 'json',
                data: {},
                success: function (result) {
                    var data = result;
                    if(data.length > 0) {
                        $("#display").hide();
                    }
                    else{
                        $("#display").show();
                    } 
                    $("#moduleImage tr").remove();
                    for (var i = 0; i < data.length; i++) {
                        //$("#moduleImage").append("<tr><td>" + data[i].ModuleSampleImageId + "</td><td><div class='item'><img src='" + data[i].SampleImage + "' width='300px' height='200px'/><div class='item-overlay top'></div></div></td><td>" + data[i].ImageDesc + "</td><td><button type='button' onclick='removeModuleImage(" + data[i].ModuleSampleImageId + ")'></button></td></tr>")
                        $("#moduleImage").append("<tr><td>" + data[i].ModuleSampleImageId + "</td><td><div class='item'><img src='" + data[i].SampleImage + "' width='300px' height='200px'/><div class='item-overlay top'></div></div></td><td>" + data[i].ImageDesc + "</td></tr>")
                    }
                },
                error: function (error) {
                    //$("#eroor").html(error.responseText);
                }
            });
        }

        $('#btnUpload').click(function () {
            var moduleId = $("#ModuleMaster").val();
            if (moduleId != "") {
                var fd = new FormData();
                //Take the first selected file
                var fileUpload = $("#FileUpload1").get(0);
                //var files = fileUpload.files;

                var files = fileUpload.files;
                //var i = files.name;

                fd.append("file", files[0]);
                //fd.append("UserId", userId);
                fd.append("ModuleId", $("#ModuleMaster").val());
                fd.append("ModuleImageDesc", $("#moduleImageDesc").val());
                //fd.append("userModuleImageId", UserImageId);

                $.ajax({
                    url: '/Module/UploadFiles',
                    type: "POST",
                    processData: false,
                    contentType: false,
                    data: fd,
                    success: function (response) {
                        //code after success
                        alert("Upload Successfyllly!!");
                        getImageByModule(moduleId);
                    },
                    error: function (er) {
                        console.log(er);
                        alert(er);
                    }
                });
            }
            else {
                alert("Please select the module first! ");
            }
        });

    });

    //removeModuleImage
    function removeModuleImage(i) {
        alert(i);
    }
</script>